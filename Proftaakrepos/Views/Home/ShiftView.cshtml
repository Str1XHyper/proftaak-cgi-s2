@using MySql.Data.MySqlClient;

@{
    ViewData["Title"] = "ShiftView";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link rel="stylesheet" href="~/css/ShiftView.css" />

@functions {
    private string[] GetNameByUID(int UserID)
    {
        MySqlConnection cnn;
        string connetionString = "server=185.182.57.161;database=tijnvcd415_Proftaak;uid=tijnvcd415_Proftaak;pwd=Proftaak;";
        cnn = new MySqlConnection(connetionString);
        MySqlCommand cmd = new MySqlCommand();
        cmd.Connection = cnn;
        cmd.CommandText = $"Select * From Werknemers Where UserId = {UserID}";
        try
        {
            string[] returnStrings = new string[10];
            cnn.Open();
            var reader = cmd.ExecuteReader();
            while (reader.Read())
            {
                for (int i = 0; i < reader.FieldCount; i++)
                {
                    returnStrings[i] = reader[i].ToString(); //I only used array as an example but you may use built in collections.
                }
                break;
            }
            cnn.Close();
            return returnStrings;
        }
        catch (Exception ex)
        {
            return new string[] { "Can not open connection ! " + ex.Message.ToString()};
        }
    }

    private int Entries()
    {
        MySqlConnection cnn;
        string connetionString = "server=185.182.57.161;database=tijnvcd415_Proftaak;uid=tijnvcd415_Proftaak;pwd=Proftaak;";
        cnn = new MySqlConnection(connetionString);
        MySqlCommand cmd = new MySqlCommand();
        cmd.Connection = cnn;
        cmd.CommandText = $"Select count(UserIdIssuer) From TradeRequest";
        try
        {
            var someValue = new object();
            cnn.Open();
            var reader = cmd.ExecuteReader();
            while (reader.Read())
            {
                someValue = reader["count(UserIdIssuer)"];
                // Do something with someValue
            }
            cnn.Close();
            return Convert.ToInt32(someValue);
        }
        catch (Exception ex)
        {
            return -1;
        }
    }

    private string[] GetRequest(int TradeID)
    {
        MySqlConnection cnn;
        string connetionString = "server=185.182.57.161;database=tijnvcd415_Proftaak;uid=tijnvcd415_Proftaak;pwd=Proftaak;";
        cnn = new MySqlConnection(connetionString);
        MySqlCommand cmd = new MySqlCommand();
        cmd.Connection = cnn;
        cmd.CommandText = $"Select * From TradeRequest Where TradeId = {TradeID}";
        try
        {
            string[] returnStrings = new string[6];
            cnn.Open();
            var reader = cmd.ExecuteReader();
            while (reader.Read())
            {
                for (int i = 0; i < reader.FieldCount; i++)
                {
                    returnStrings[i] = reader[i].ToString(); //I only used array as an example but you may use built in collections.
                }
                break;
            }
            cnn.Close();
            return returnStrings;
        }
        catch (Exception ex)
        {
            //"Can not open connection ! " + ex.Message.ToString()
            return null;
        }
    }
}

<div class="window">
    <h1>ShiftView</h1>

    @* Incomming request box *@
    <h1 class="incommingH1">Incomming requests</h1>
    <div class="topSpacer1"></div>
    <div class="RequestsRecieved">
        @{

            for (int i = 0; i < Entries(); i++)
            {
                string[] requestOutput = GetRequest(i);
                string[] userIDDetails = GetNameByUID(Convert.ToInt32(requestOutput[0]));

                <div class="exampleRequest">
                    <span class="requestText"> @requestOutput[2] to @requestOutput[3] <span>- @userIDDetails[1] @userIDDetails[2] @userIDDetails[3]</span></span>
                    <img src="~/img/check-solid.svg" alt="No" class="add">
                    <img src="~/img/ban-solid.svg" alt="No" class="block">
                </div>
            }
        }
    </div>
    <div class="bottomSpacer1"></div>

    @* Create a request - box *@
    <h1 class="createH1">Create a request</h1>
    <div class="CreateRequest">

    </div>
</div>