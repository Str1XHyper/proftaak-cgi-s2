@using MySql.Data.MySqlClient;
@using Microsoft.AspNetCore.Http;
@using ClassLibrary.Classes;

@{
    ViewData["Title"] = "Inkomende Aanvragen";
    Layout = "~/Views/Shared/_Layout.cshtml";
    string authCode = ViewData["UserInfo"].ToString();
    string currentId = ShiftView.GetLoggedInUserId(authCode);
    List<string[]> tradeRequests = ShiftView.GetRequests();
    List<string[]> users = ShiftView.GetUsers();
}
<script src="~/js/ShiftView.js"></script>

@* NEW DESIGN *@
@*<ul class="list-group">
        <li class="list-group-item d-flex justify-content-between align-items-center">
            Cras justo odio
            <div class="input-group-append">
                <button class="btn btn-outline-success mr-1" style="width: 50px"><i class="fas fa-check"></i></button>
                <button class="btn btn-outline-danger" style="width: 50px"><i class="fas fa-times"></i></button>
            </div>
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center">
            Dapibus ac facilisis in
            <div class="input-group-append">
                <button class="btn btn-outline-success mr-1" style="width: 50px"><i class="fas fa-check"></i></button>
                <button class="btn btn-outline-danger" style="width: 50px"><i class="fas fa-times"></i></button>
            </div>
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center">
            Morbi leo risus
            <div class="input-group-append">
                <button class="btn btn-outline-success mr-1" style="width: 50px"><i class="fas fa-check"></i></button>
                <button class="btn btn-outline-danger" style="width: 50px"><i class="fas fa-times"></i></button>
            </div>
        </li>
    </ul>*@



<div class="container-fluid">
    <div class="card mb-4">
        <div class="card-header bg-dark text-white">Ruilverzoeken van anderen</div>
        <div class="card-body">
            <ul class="list-group">
                @{
                    int activeRequests = 0;
                    foreach (string[] request in tradeRequests)
                    {
                        string name = "";
                        string[] blockedIds = request[6].Split(",").ToArray();
                        DateTime date = Convert.ToDateTime(request[2]);
                        int compareResult = DateTime.Compare(date, DateTime.Now);
                        if (request[0] != currentId && !blockedIds.Contains(currentId.ToString()) && Convert.ToBoolean(request[1]) != true && compareResult > 0)
                        {
                            activeRequests++;
                            foreach (string[] user in users)
                            {
                                if (user[0] == request[0])
                                {
                                    name = user[1] + " " + user[2] + " " + user[3];
                                }
                            }
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                @request[2] - @request[3] - @name
                                <div class="input-group-append">
                                    <a class="btn btn-outline-success mr-1" style="width: 50px" asp-controller="Shiftview" asp-action="HandleRequest" asp-route-UserID="@currentId" asp-route-TradeID="@request[5]" asp-route-EventID="@request[7]" method="Post">
                                        <i class="fas fa-check"></i>
                                    </a>
                                    <a class="btn btn-outline-danger" style="width: 50px" asp-controller="Shiftview" asp-action="Block" asp-route-UserID="@currentId" asp-route-TradeID="@request[5]" asp-route-DisabledIds="@request[6]" method="Post">
                                        <i class="fas fa-times"></i>
                                    </a>
                                </div>
                            </li>
                        }
                    }
                    if (activeRequests == 0)
                    {
                        <h5>Er zijn nog geen ruilaanvragen.</h5>
                    }
                }
            </ul>
        </div>
    </div>
</div>