@using MySql.Data.MySqlClient;
@using Microsoft.AspNetCore.Http;
@using ClassLibrary.Classes;
@model ShiftViewModel;

@{
    ViewData["Title"] = "Create a Request";
    Layout = "~/Views/Shared/_Layout.cshtml";
    string authCode = ViewData["UserInfo"].ToString();
    string currentId = ShiftView.GetLoggedInUserId(authCode);
    List<string[]> dienstInfo = ShiftView.GetDiensten(Convert.ToInt32(currentId));
    List<string[]> tradeRequests = ShiftView.GetRequests();
}

@*<link rel="stylesheet" href="~/css/ShiftView.css" />*@
@*<link rel="stylesheet" href="~/css/w3.css">*@
<script src="~/js/ShiftView.js"></script>

<div class="container-fluid">
    <div class="card mb-4">
        <div class="card-header bg-dark text-white">Ruilverzoek aanmaken</div>
        <div class="card-body">
            <div class="container-fluid">
                <form asp-action="CreateRequest" asp-controller="Shiftview" method="post">
                    <input type="hidden" value="@currentId" name="UserID" />
                    <div class="input-group">
                        <select name="EventID" id="EventID" class="custom-select">
                            <option selected>Kies een dienst</option>
                            @{
                                foreach (string[] dienst in dienstInfo)
                                {
                                    DateTime dateTime = DateTime.Parse(dienst[4]);
                                    DateTime now = DateTime.Now;
                                    int compareResult = DateTime.Compare(dateTime, now);
                                    if (dienst[4] != null && compareResult > 0)
                                    {
                                        if (dienst[8].ToLower() == "false")
                                        {
                                            <option value="@dienst[0]">@dienst[2] | @dienst[4] - @dienst[5]</option>
                                        }
                                    }
                                }
                            }
                        </select>
                        <div class="input-group-append">
                            <button type="submit" class="btn btn-outline-secondary">Ruilverzoek aanmaken</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="card mb-4">
        <div class="card-header bg-dark text-white">Uw ruilverzoeken</div>
        <div class="card-body">
            <div class="card text-center">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs">
                        <li class="nav-item">
                            <button id="ActiveButton" onclick="openTab(event, 'Active')" class="tablink Active nav-link active" href="#">Actieve aanvragen</button>
                        </li>
                        <li class="nav-item">
                            <button id="AcceptedButton" onclick="openTab(event, 'Accepted')" class="tablink Accepted nav-link" href="#">Geaccepteerde aanvragen</button>
                        </li>
                        <li class="nav-item">
                            <button id="ExpiredButton" onclick="openTab(event, 'Expired')" class="tablink Expired nav-link" href="#" tabindex="-1" aria-disabled="true">Verlopen aanvragen</button>
                        </li>
                    </ul>
                </div>
                <div id="Active" class="tab card-body">
                    <ul class="list-group">
                        @{
                            foreach (string[] dienst in dienstInfo)
                            {
                                DateTime dateTime = DateTime.Parse(dienst[4]);
                                DateTime now = DateTime.Now;
                                int compareResult = DateTime.Compare(dateTime, now);
                                if (dienst[1] == currentId && compareResult > 0)
                                {
                                    if (dienst[8].ToLower() == "true")
                                    {
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            @dienst[2] | @dienst[4] - @dienst[5]
                                            <div class="input-group-append">
                                                <button class="btn btn-outline-success mr-1" style="width: 50px"><i class="fas fa-check"></i></button>
                                                <button class="btn btn-outline-danger" style="width: 50px"><i class="fas fa-times"></i></button>
                                            </div>
                                        </li>
                                    }
                                }
                            }
                        }
                    </ul>
                </div>
                <div id="Accepted" class="tab card-body" style="display:none;">
                    <ul class="list-group">
                        @{
                            foreach (string[] request in tradeRequests)
                            {
                                if(request[0] == currentId && Convert.ToInt32(request[4]) != -1)
                                {
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        @request[2] - @request[3] | Geaccepteerd door @request[4]
                                    </li>
                                }
                                
                            }
                        }
                    </ul>
                </div>
                <div id="Expired" class="tab card-body" style="display:none;">
                    <ul class="list-group">
                        @{
                            foreach (string[] dienst in dienstInfo)
                            {
                                DateTime dateTime = DateTime.Parse(dienst[4]);
                                DateTime now = DateTime.Now;
                                int compareResult = DateTime.Compare(dateTime, now);
                                if (dienst[1] == currentId && compareResult <= 0)
                                {
                                    if (dienst[8].ToLower() == "true")
                                    {
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            @dienst[2] | @dienst[4] - @dienst[5]
                                        </li>
                                    }
                                }
                            }
                        }
                    </ul>
                </div>
            </div>
        </div>
</div>

@*<div class="window">*@
@* Create a request - box *@
@*<h1 class="createH1">Ruilverzoek aanmaken</h1>
    <div class="CreateRequest">
        <div class="position-static">
            <form asp-action="CreateRequest" asp-controller="Shiftview" method="post" class="CreateRequestForm">
                <input type="hidden" value="@currentId" name="UserID" />
                <select name="EventID" id="EventID" class="RoosterDropDown">
                    @{
                        for (int i = 1; i <= ShiftView.EntryCount("EventId", "Rooster"); i++)
                        {
                            List<string> dienstInfo = ShiftView.GetDiensten(Convert.ToInt32(currentId), i);

                            if (ShiftView.HasCorrectInfo(dienstInfo))
                            {
                                DateTime dateTime = DateTime.Parse(dienstInfo[4]);
                                DateTime now = DateTime.Now;
                                int compareResult = DateTime.Compare(dateTime, now);
                                if (dienstInfo[4] != null && compareResult > 0)
                                {
                                    if (dienstInfo[8].ToLower() == "false")
                                    {
                                        <option value="@dienstInfo[0]">@dienstInfo[4] - @dienstInfo[5]</option>
                                    }
                                }
                            }
                        }
                    }
                </select>
                <input type="submit" value="Vraag ruilverzoek aan" class="SubmitButton" />
            </form>
            <div class="activeRequests">
                <h2>Uw ruilaanvragen</h2>
                <div class="w3-bar">
                    <button class="Active w3-bar-item w3-button w3-hover-white tablink w3-black" onclick="openTab(event,'Active')">Actieve aanvragen</button>
                    <button class="Expired w3-bar-item w3-button w3-hover-white tablink" onclick="openTab(event,'Expired')">Verlopen aanvragen</button>
                </div>
            </div>
            <h2 id="status">Actieve aanvragen</h2>
        </div>
        <div id="Active" class="w3-container w3-border tab requests">*@
@*@{
    for (int i = 1; i <= ShiftView.EntryCount("TradeID", "TradeRequest"); i++)
    {
        string[] disabledIds;
        string[] requestOutput = ShiftView.GetRequests(i).ToArray();
        if (requestOutput[6].Contains(','))
        {
            disabledIds = requestOutput[6].Split(",");
        }
        else
        {
            disabledIds = new string[] { requestOutput[6] };
        }
        string[] issuerDetails = ShiftView.GetNameByUIDs(Convert.ToInt32(requestOutput[0])).ToArray();

        string[] times = ShiftView.FixTimeStamp(requestOutput);

        string date = times[0];
        string startTime = times[1];
        string endTime = times[2];

        if (requestOutput[0] == currentId)
        {
            <div class="exampleRequest">
                <span class="requestText">@date @startTime tot @endTime <span>- @issuerDetails[1] @issuerDetails[2] @issuerDetails[3]</span></span>*@
@*<a asp-controller="Home" asp-action="HandleRequest" asp-route-UserID="@currentId" asp-route-TradeID="@i" method="Post" class="button">
        <img src="~/img/check-solid.svg" alt="No">
    </a>
    <a asp-controller="Home" asp-action="Block" asp-route-UserID="@currentId" asp-route-TradeID="@i" asp-route-DisabledIds="@requestOutput[6]" method="Post" class="button">
        <img src="~/img/ban-solid.svg" alt="No">
    </a>*@
@*</div>
            }
        }
    }*@
@*</div>
            <div id="Expired" class="w3-container w3-border tab" style="display:none">
                <p>Uw verlopen aanvragen zullen hier te zien zijn.</p>
            </div>
        </div>
    </div>*@